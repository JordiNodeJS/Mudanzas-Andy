# Cursor Rules para Proyecto Mudanzas-Andy (Astro v5.13.2)

## üö® REGLAS CR√çTICAS - SEGUIR SIEMPRE

### COMPONENTES ASTRO - SINTAXIS OBLIGATORIA
- NUNCA usar `export let` - causa problemas de renderizaci√≥n
- SIEMPRE usar `interface Props` + `Astro.props`
- Estructura obligatoria: imports ‚Üí interface ‚Üí destructuring ‚Üí template ‚Üí styles

### EJEMPLO CORRECTO:
```astro
---
interface Props {
  title: string;
  description?: string;
}

const { title, description = "" } = Astro.props;
---

<div class="component">
  <h2>{title}</h2>
  <p>{description}</p>
  <slot />
</div>
```

### EJEMPLO INCORRECTO:
```astro
---
export let title: string = "";  // ‚ùå PROBLEM√ÅTICO
export let description: string = "";
---
```

## üöÄ STACK TECNOL√ìGICO Y VERSIONES

### Framework Principal
- **Astro**: 5.x (Vite 7) con integraciones `@astrojs/react`, `@astrojs/mdx`, `@astrojs/sitemap` y `astro-auto-import`
- **UI**: Tailwind CSS 4 con plugin `@tailwindcss/vite` y Bootstrap Grid System personalizado
- **Tipado**: TypeScript estricto (`extends: "astro/tsconfigs/strict"`)
- **Contenido**: `astro:content` v5 (Content Layer API) con colecciones en `src/content` y esquemas en `src/content.config.ts`
- **Gesti√≥n de paquetes**: PNPM (requerido) - NO uses npm o yarn
- **Fuentes**: `astro-font` para optimizaci√≥n autom√°tica de fuentes
- **Analytics**: `@digi4care/astro-google-tagmanager` controlado por `src/config/config.json`

### Arquitectura de Renderizado
- **Hosting**: Sitio completamente est√°tico (SSG) - puede subirse a hosting b√°sico como Hostinger
- **Componentes React**: Se hidratan en cliente con directivas apropiadas (`client:*`)
- **Sin SSR**: No usa `output: 'server'` ni adaptadores de servidor

## üìã EST√ÅNDARES DEL PROYECTO

### Nomenclatura:
- Componentes: PascalCase (Card.astro, ServiceCard.astro)
- Archivos: kebab-case (index.astro, service-card.astro)
- Props: camelCase (buttonText, imageSrc)

### Organizaci√≥n:
```
src/
‚îú‚îÄ‚îÄ pages/           # Rutas de Astro (file-based routing)
‚îú‚îÄ‚îÄ layouts/         # Layouts base y componentes de layout
‚îÇ   ‚îú‚îÄ‚îÄ components/  # Componentes Astro reutilizables
‚îÇ   ‚îú‚îÄ‚îÄ partials/    # Header, Footer, CTA
‚îÇ   ‚îî‚îÄ‚îÄ shortcodes/  # Componentes MDX auto-importados
‚îú‚îÄ‚îÄ content/         # Colecciones de contenido (blog, careers, etc.)
‚îú‚îÄ‚îÄ lib/             # Utilidades y helpers
‚îú‚îÄ‚îÄ styles/          # CSS layers y utilidades personalizadas
‚îî‚îÄ‚îÄ config/          # Archivos de configuraci√≥n JSON
```

### Alias de Importaci√≥n (tsconfig.json)
SIEMPRE usa estos alias en lugar de rutas relativas:
- `@/components/*` ‚Üí `src/layouts/components/*`
- `@/shortcodes/*` ‚Üí `src/layouts/shortcodes/*`
- `@/partials/*` ‚Üí `src/layouts/partials/*`
- `@/*` ‚Üí `src/*`

### Imports:
- Usar `import type` para tipos
- Importar componentes con ruta relativa
- Evitar imports con destructuring para componentes

## üîß COMANDOS √öTILES
- `pnpm dev` - Servidor de desarrollo
- `pnpm build` - Build de producci√≥n
- `pnpm preview` - Preview del build
- `astro check` - Verificar tipos TypeScript
- `astro sync` - Sincronizar tipos generados

## üéØ ASTRO 5 - MEJORES PR√ÅCTICAS

### Content Collections (Content Layer API)
- **Ubicaci√≥n**: Define colecciones en `src/content.config.ts`
- **Loaders**: Usa `glob()` y `file()` loaders nativos
- **Schemas**: Siempre define schemas con Zod para validaci√≥n
- **Consultas**: Usa `getCollection()` y `getEntry()` con tipos apropiados

```ts
import { defineCollection, z } from 'astro:content';
import { glob } from 'astro/loaders';

const blog = defineCollection({
  loader: glob({ pattern: "**/*.md", base: "./src/content/blog" }),
  schema: z.object({
    title: z.string(),
    description: z.string().optional(),
    pubDate: z.coerce.date(),
    featured: z.boolean().default(false),
  })
});
```

### Componentes y Layouts
- **Props tipadas**: Siempre usa interfaces TypeScript para props
- **Layout base**: Usa `src/layouts/Base.astro` como wrapper principal
- **Metadatos**: Pasa `title`, `meta_title`, `description`, `image` cuando sea necesario
- **Slots**: Usa slots nombrados para contenido estructurado

### Islas de React
- **Principio**: Astro renderiza HTML por defecto, usa React SOLO para interactividad
- **Directivas de hidrataci√≥n**:
  - `client:load` - Para interacci√≥n inmediata (formularios cr√≠ticos)
  - `client:idle` - Para componentes diferibles (widgets)
  - `client:visible` - Para contenido que entra en viewport (carruseles)
- **Importaciones**: Aseg√∫rate que componentes React est√©n en `layouts/function-components/`

```astro
---
import InteractiveForm from "@/function-components/InteractiveForm.jsx";
---

<InteractiveForm client:load />
```

## üé® TAILWIND CSS 4 - EST√ÅNDARES

### Metodolog√≠a CSS
- **Layers**: Respeta la estructura de `main.css` (@layer base, @layer components)
- **Utilidades**: Prioriza clases utilitarias sobre CSS personalizado
- **Componentes**: Usa `@apply` SOLO en `src/styles/components.css`
- **Variables**: Usa CSS custom properties definidas en `tw-theme.js`
- **Grid**: Sistema h√≠brido Bootstrap Grid + Tailwind Flex

### Patrones de Clases
```astro
<!-- Contenedor est√°ndar -->
<div class="container">
  <div class="row items-center">
    <div class="lg:col-6">
      <!-- Contenido -->
    </div>
  </div>
</div>

<!-- Botones usando clases componente -->
<a class="btn btn-primary" href="/contact">Contact Us</a>
<a class="btn btn-white btn-sm" href="/learn-more">Learn More</a>
```

### Responsividad y Accesibilidad
- **Mobile-first**: Usa breakpoints progresivos (`sm:`, `md:`, `lg:`, `xl:`)
- **Estados focus**: Siempre incluye estados focus visibles
- **Contraste**: Asegura contraste suficiente (AA m√≠nimo)
- **Sem√°ntica**: Usa elementos HTML sem√°nticos apropiados

## üìö GESTI√ìN DE CONTENIDO Y ASSETS

### Assets e Im√°genes
- **Astro Assets**: Usa `astro:assets` (`<Image />`) para im√°genes procesables
- **Public assets**: Enlaces absolutos desde `/` para archivos en `public/`
- **Optimizaci√≥n**: Siempre define `width`, `height` y `alt` descriptivo
- **Fuentes**: NO a√±adas manualmente `<link>` a Google Fonts - usa `AstroFont`

```astro
---
import { Image } from "astro:assets";
---

<Image
  src="/images/hero-banner.png"
  alt="Descripci√≥n significativa de la imagen"
  width={800}
  height={400}
  loading="lazy"
/>
```

### Content Collections - Patrones
- **Frontmatter**: Mant√©n coherencia con el schema definido
- **Referencias**: Usa `reference()` para vincular entre colecciones
- **Filtrado**: Ordena manualmente las colecciones (`getCollection` no garantiza orden)

```astro
---
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---
```

## ‚öôÔ∏è CONFIGURACI√ìN Y PERSONALIZACI√ìN

### Archivos de Configuraci√≥n
- **Centralizada**: Toda la configuraci√≥n en `src/config/*.json`
- **Tipado**: Define interfaces TypeScript para objetos de configuraci√≥n
- **Ambiente**: Usa variables de entorno para datos sensibles
- **Cache**: Reutiliza configuraciones, evita lecturas m√∫ltiples

### Utilidades y Helpers
- **Reutilizaci√≥n**: Usa utilidades existentes antes de crear nuevas:
  - `markdownify()` - Convierte markdown a HTML inline
  - `plainify()` - Elimina HTML y entities
  - `humanize()` - Formatea strings para mostrar
  - `slugify()` - Genera slugs URL-safe
- **Ubicaci√≥n**: Nuevas utilidades en `src/lib/utils/`

## üöÄ RENDIMIENTO Y OPTIMIZACI√ìN

### Estrategias de Carga
- **JavaScript m√≠nimo**: Evita hidratar componentes innecesariamente
- **Lazy loading**: Usa `loading="lazy"` en im√°genes
- **Critical CSS**: Mant√©n CSS cr√≠tico inline cuando sea necesario
- **Bundle splitting**: Separa dependencias pesadas del cliente

### SEO y Meta Tags
- **Layout Base**: Usa `Base.astro` para metadatos consistentes
- **Open Graph**: Completa metadatos OG/Twitter v√≠a props del layout
- **Canonical URLs**: Define URLs can√≥nicas para evitar contenido duplicado
- **Structured Data**: A√±ade JSON-LD cuando sea apropiado

## ‚ö†Ô∏è PROBLEMAS CONOCIDOS
- Props no se renderizan ‚Üí Verificar interface Props + Astro.props
- Si fallan componentes ‚Üí Renderizar HTML directamente en p√°gina
- Cache corrupto ‚Üí Limpiar .astro/ y node_modules/.astro/

## üîß WORKFLOW Y COMANDOS DE DESARROLLO

### Scripts Disponibles
- **Desarrollo**: `pnpm dev` (puerto 4321)
- **Build**: `pnpm build` (genera carpeta `dist/` est√°tica)
- **Type-check**: `pnpm check` (verifica errores TypeScript)
- **Formato**: `pnpm format` (Prettier con plugins de Astro y Tailwind)
- **Preview**: `pnpm preview` (servidor para probar build)

### Pre-commit Checklist
1. ‚úÖ Ejecuta `pnpm check` - Sin errores TypeScript
2. ‚úÖ Ejecuta `pnpm build` - Build exitoso
3. ‚úÖ Ejecuta `pnpm format` - C√≥digo formateado
4. ‚úÖ Verifica alias de importaci√≥n v√°lidos
5. ‚úÖ Confirma ausencia de `any` no justificado

## üö® ANTIPATRONES (EVITAR)

### Astro/React
- ‚ùå Hidratar componentes sin interactividad real
- ‚ùå Usar React para contenido est√°tico
- ‚ùå M√∫ltiples `client:load` en la misma p√°gina
- ‚ùå Importar librer√≠as pesadas en el cliente

### TypeScript
- ‚ùå Usar `any` sin justificaci√≥n documentada
- ‚ùå Suprimir errores TypeScript con `@ts-ignore`
- ‚ùå Props sin tipar en componentes
- ‚ùå Mutaciones directas de props de solo lectura

### CSS/Tailwind
- ‚ùå CSS inline para estilos complejos
- ‚ùå Duplicar utilidades existentes
- ‚ùå Clases !important innecesarias
- ‚ùå Estilos que rompen responsive design

### Arquitectura
- ‚ùå L√≥gica de negocio en componentes de presentaci√≥n
- ‚ùå Rutas relativas largas en lugar de alias
- ‚ùå Configuraci√≥n dispersa (usar `config/*.json`)
- ‚ùå Scripts de terceros fuera del control de configuraci√≥n

## üìö REFERENCIAS
- **Documentaci√≥n oficial:** https://docs.astro.build/
- **Problema documentado:** .github/docs/astro-props-debugging.md
- **Reglas completas:** .github/cursor-rules.md
- **Tailwind CSS 4:** https://tailwindcss.com/docs
- **TypeScript Handbook:** https://typescriptlang.org/docs

## üéØ OBJETIVO
Crear componentes Astro funcionales, mantenibles y sin problemas de renderizaci√≥n siguiendo las mejores pr√°cticas de Astro 5.x, Tailwind CSS 4 y TypeScript estricto.

## üìù **REGLAS DE COMMITS**

### **IDIOMA OBLIGATORIO:**
- **SIEMPRE escribir commits en INGL√âS**
- **NUNCA usar espa√±ol en mensajes de commit**
- **Formato est√°ndar:** `type(scope): description`

### **EJEMPLOS CORRECTOS:**
```bash
feat(components): add new Card component with TypeScript props
fix(astro): resolve component rendering issues
docs(readme): update project documentation
style(cards): improve responsive design
refactor(components): clean up unused components
```

### **EJEMPLOS INCORRECTOS:**
```bash
feat(componentes): a√±adir nueva tarjeta  # ‚ùå NO ESPA√ëOL
fix(astro): arreglar problemas de renderizado  # ‚ùå NO ESPA√ëOL
docs(readme): actualizar documentaci√≥n  # ‚ùå NO ESPA√ëOL
```

### **TIPOS DE COMMIT RECOMENDADOS:**
- `feat:` - Nueva funcionalidad
- `fix:` - Correcci√≥n de bugs
- `docs:` - Documentaci√≥n
- `style:` - Cambios de estilo/UI
- `refactor:` - Refactorizaci√≥n de c√≥digo
- `test:` - A√±adir o modificar tests
- `chore:` - Tareas de mantenimiento

## üéØ INSTRUCCIONES ESPEC√çFICAS PARA CURSOR AI

### Comunicaci√≥n
- **Idioma**: Responde SIEMPRE en espa√±ol en comentarios y descripciones
- **Commits**: Mensajes de commit en ingl√©s usando Conventional Commits
- **Documentaci√≥n**: Comenta c√≥digo complejo en espa√±ol

### Metodolog√≠a de Edici√≥n
- **Conservaci√≥n**: NO reformatees c√≥digo existente m√°s all√° del cambio necesario
- **Imports**: Usa alias `@/...` en lugar de rutas relativas
- **Reutilizaci√≥n**: Prefiere editar/extender componentes existentes antes que crear nuevos
- **Consistencia**: Mant√©n el estilo y convenciones del c√≥digo circundante

### Patrones de Desarrollo
- **Componentes nuevos**: Sigue estructura existente en `layouts/components/`
- **Estilos**: A√±ade clases a `src/styles/components.css` si es necesario
- **Utilidades**: Extiende utilidades existentes antes de crear nuevas
- **Testing**: Prueba cambios en diferentes breakpoints y navegadores

---

**√öltima actualizaci√≥n:** 22 de agosto de 2025  
**Versi√≥n de Astro:** 5.13.2  
**Stack:** Astro 5.x + Tailwind CSS 4 + TypeScript + Content Collections  
**Estado:** ‚úÖ Reglas validadas y probadas
