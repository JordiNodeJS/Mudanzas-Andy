---
import "../styles/global.css";
import CookieBanner from "../components/CookieBanner.astro";
import { ClientRouter } from "astro:transitions";

// ConfiguraciÃ³n centralizada
const analyticsConfig = {
  google: {
    analytics: { measurement_id: "G-VK65C53TET" },
    search_console: { verification_code: "" },
    tag_manager: { container_id: "GTM-5NH8WKQC" },
  },
  bing: {
    webmaster_tools: { verification_code: "E00F433172C8065A658092822181BD08" },
  },
  meta: { domain_verification: "" },
};

interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  keywords?: string;
  robots?: string;
}

const {
  title = "Mudanzas Profesionales Barcelona âš¡ Presupuesto GRATIS | Mudanzas ANDY",
  description = "ðŸš› Mudanzas profesionales en Barcelona y EspaÃ±a. âœ… Presupuesto GRATIS en 5 min por WhatsApp âœ… Precio cerrado sin sorpresas âœ… AtenciÃ³n 24/7 âœ… Embalaje incluido",
  image = "/og-image.jpg",
  canonical = Astro.url.href,
  keywords = "mudanzas Barcelona, mudanzas profesionales, empresa mudanzas Barcelona, mudanzas baratas, presupuesto mudanza gratis, mudanzas particulares, mudanzas oficinas",
  robots = "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1",
} = Astro.props satisfies Props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- OptimizaciÃ³n extrema: CSS crÃ­tico inline minimalista -->
    <style>
      /* Reset crÃ­tico ultra-minimalista */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }
      html {
        scroll-padding-top: 5rem;
        scroll-behavior: smooth;
      }
      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        line-height: 1.6;
      }

      /* Container crÃ­tico optimizado */
      .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 1rem;
      }

      /* Layout esencial - solo above-the-fold */
      .relative {
        position: relative;
      }
      .absolute {
        position: absolute;
      }
      .fixed {
        position: fixed;
      }
      .inset-0 {
        inset: 0;
      }
      .z-10 {
        z-index: 10;
      }
      .z-20 {
        z-index: 20;
      }
      .z-30 {
        z-index: 30;
      }
      .z-40 {
        z-index: 40;
      }
      .z-50 {
        z-index: 50;
      }

      /* Dimensiones crÃ­ticas */
      .w-full {
        width: 100%;
      }
      .h-full {
        height: 100%;
      }
      .h-auto {
        height: auto;
      }
      .min-h-screen {
        min-height: 100vh;
      }

      /* Display crÃ­tico */
      .block {
        display: block;
      }
      .inline {
        display: inline;
      }
      .inline-block {
        display: inline-block;
      }
      .flex {
        display: flex;
      }
      .inline-flex {
        display: inline-flex;
      }
      .grid {
        display: grid;
      }
      .hidden {
        display: none;
      }

      /* Flexbox crÃ­tico */
      .flex-col {
        flex-direction: column;
      }
      .flex-row {
        flex-direction: row;
      }
      .flex-wrap {
        flex-wrap: wrap;
      }
      .items-center {
        align-items: center;
      }
      .justify-center {
        justify-content: center;
      }
      .justify-between {
        justify-content: space-between;
      }
      .space-x-2 > :not([hidden]) ~ :not([hidden]) {
        margin-left: 0.5rem;
      }
      .space-x-3 > :not([hidden]) ~ :not([hidden]) {
        margin-left: 0.75rem;
      }
      .space-y-2 > :not([hidden]) ~ :not([hidden]) {
        margin-top: 0.5rem;
      }
      .space-y-3 > :not([hidden]) ~ :not([hidden]) {
        margin-top: 0.75rem;
      }

      /* Spacing crÃ­tico */
      .p-4 {
        padding: 1rem;
      }
      .px-4 {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .py-3 {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
      }
      .py-4 {
        padding-top: 1rem;
        padding-bottom: 1rem;
      }
      .mt-2 {
        margin-top: 0.5rem;
      }
      .mt-3 {
        margin-top: 0.75rem;
      }

      /* Texto crÃ­tico */
      .text-center {
        text-align: center;
      }
      .text-left {
        text-align: left;
      }
      .text-sm {
        font-size: 0.875rem;
      }
      .text-base {
        font-size: 1rem;
      }
      .font-bold {
        font-weight: 700;
      }

      /* Colores crÃ­ticos usando variables CSS */
      .bg-secondary {
        background-color: rgb(var(--color-secondary, 103 145 134));
      }
      .bg-primary {
        background-color: rgb(var(--color-primary, 38 78 112));
      }
      .text-white {
        color: #fff;
      }
      .text-highlight {
        color: rgb(var(--color-highlight, 250 227 96));
      }
      .text-neutral {
        color: rgb(var(--color-neutral, 187 212 206));
      }

      /* Borders y radius crÃ­tico */
      .rounded-lg {
        border-radius: 0.5rem;
      }
      .border-2 {
        border-width: 2px;
      }
      .border-[#bbd4ce] {
        border-color: #bbd4ce;
      }

      /* Transiciones crÃ­ticas */
      .transition-all {
        transition: all 0.3s ease;
      }
      .duration-300 {
        transition-duration: 300ms;
      }
      .duration-500 {
        transition-duration: 500ms;
      }

      /* Transform crÃ­tico */
      .transform {
        transform: translateZ(0);
      }
      .translate-y-full {
        transform: translateY(100%);
      }
      .-translate-y-full {
        transform: translateY(-100%);
      }

      /* Buttons crÃ­tico */
      .btn-primary {
        background: rgb(var(--color-primary, 38 78 112));
        color: #fff;
        padding: 0.75rem 1.5rem;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }
      .btn-primary:hover {
        background: rgba(var(--color-primary, 38 78 112), 0.9);
        transform: translateY(-1px);
      }
      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      /* Responsive crÃ­tico */
      @media (min-width: 640px) {
        .sm\\:flex-row {
          flex-direction: row;
        }
        .sm\\:space-y-0 > :not([hidden]) ~ :not([hidden]) {
          margin-top: 0;
        }
        .sm\\:space-x-2 > :not([hidden]) ~ :not([hidden]) {
          margin-left: 0.5rem;
        }
        .sm\\:space-x-3 > :not([hidden]) ~ :not([hidden]) {
          margin-left: 0.75rem;
        }
        .sm\\:hidden {
          display: none;
        }
        .sm\\:inline {
          display: inline;
        }
      }
      @media (min-width: 1024px) {
        .lg\\:flex-row {
          flex-direction: row;
        }
        .lg\\:space-y-0 > :not([hidden]) ~ :not([hidden]) {
          margin-top: 0;
        }
        .lg\\:space-x-6 > :not([hidden]) ~ :not([hidden]) {
          margin-left: 1.5rem;
        }
        .lg\\:text-left {
          text-align: left;
        }
        .lg\\:text-base {
          font-size: 1rem;
        }
        .lg\\:w-auto {
          width: auto;
        }
        .lg\\:py-4 {
          padding-top: 1rem;
          padding-bottom: 1rem;
        }
        .lg\\:col-6 {
          flex: 0 0 50%;
          max-width: 50%;
        }
      }

      /* Variables de color del sistema */
      :root {
        --color-primary: 38 78 112;
        --color-secondary: 103 145 134;
        --color-accent: 249 180 171;
        --color-highlight: 250 227 96;
        --color-neutral: 187 212 206;
      }

      /* Optimizaciones de performance */
      img,
      video {
        max-width: 100%;
        height: auto;
      }
      * {
        will-change: auto;
      }
      .transform {
        transform: translateZ(0);
        will-change: transform;
      }
    </style>

    <!-- Google Tag Manager (head) - Optimizado con defer -->
    <script>
      (window as any).dataLayer = (window as any).dataLayer || [];
      (window as any).gtag = function () {
        (window as any).dataLayer.push(arguments);
      };
      (window as any).gtag("js", new Date());
      (window as any).gtag("config", "G-VK65C53TET");
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VK65C53TET"
    ></script>

    <!-- Favicons optimizados -->
    <link rel="icon" href="/favicons/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-touch-icon.png"
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- CRITICAL PERFORMANCE HINTS - ULTRA OPTIMIZED -->

    <!-- Early hints para recursos mÃ¡s crÃ­ticos -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://www.googletagmanager.com" />

    <!-- DNS prefetch para recursos secundarios -->
    <link rel="dns-prefetch" href="//www.google-analytics.com" />
    <link rel="dns-prefetch" href="//wa.me" />
    <link rel="dns-prefetch" href="//api.whatsapp.com" />

    <!-- Preload hero images con mÃ¡xima prioridad -->
    <link
      rel="preload"
      as="image"
      href="/camion/optimized/hero-fondo-mobile.avif"
      type="image/avif"
      media="(max-width: 768px)"
      fetchpriority="high"
      imagesizes="100vw"
    />
    <link
      rel="preload"
      as="image"
      href="/camion/optimized/hero-fondo.avif"
      type="image/avif"
      media="(min-width: 769px)"
      fetchpriority="high"
      imagesizes="80vw"
    />

    <!-- Preload JavaScript crÃ­tico -->
    <link rel="modulepreload" href="/js/move-reserva.js" />

    <!-- Meta tags SEO optimizados -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="robots" content={robots} />
    <link rel="canonical" href={canonical} />

    <!-- Open Graph optimizado -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.url).href} />
    <meta property="og:url" content={canonical} />
    <meta property="og:site_name" content="Mudanzas ANDY" />
    <meta property="og:locale" content="es_ES" />

    <!-- Twitter Card optimizado -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(image, Astro.url).href} />

    <!-- Schema.org JSON-LD crÃ­tico inline -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "MovingCompany",
        "name": "Mudanzas ANDY",
        "description": "Empresa de mudanzas profesionales en Barcelona y EspaÃ±a",
        "url": "https://mudanzasandy.com",
        "telephone": "+34933539792",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Barcelona",
          "addressCountry": "ES"
        },
        "areaServed": ["Barcelona", "EspaÃ±a"],
        "sameAs": ["https://wa.me/34640506084"]
      }
    </script>

    <!-- View Transitions optimizado -->
    <meta name="astro-view-transitions-enabled" content="true" />

    <!-- Optimizaciones adicionales -->
    <meta name="theme-color" content="#264e70" />
    <meta name="color-scheme" content="light" />

    <!-- Critical Web Font preload -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      /></noscript
    >
  </head>

  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
      <iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-5NH8WKQC"
        height="0"
        width="0"
        style="display:none;visibility:hidden"></iframe>
    </noscript>

    <!-- ViewTransitions component -->
    <ClientRouter />

    <!-- Main content slot -->
    <slot />

    <!-- Cookie Banner con lazy load -->
    <CookieBanner />

    <!-- JavaScript no crÃ­tico diferido -->
    <script src="/js/move-reserva.js" defer></script>
  </body>
</html>
