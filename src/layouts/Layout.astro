---
import "../styles/global.css";
import analyticsConfig from "../config/analytics.json";
import CookieBanner from "../components/CookieBanner.astro";
import { ViewTransitions } from "astro:transitions";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  keywords?: string;
  robots?: string;
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
    section?: string;
  };
}

const {
  title = "Mudanzas Profesionales Barcelona âš¡ Presupuesto GRATIS | Mudanzas ANDY",
  description = "ðŸš› Mudanzas profesionales en Barcelona y EspaÃ±a. âœ… Presupuesto GRATIS en 5 min por WhatsApp âœ… Precio cerrado sin sorpresas âœ… AtenciÃ³n 24/7 âœ… Embalaje incluido",
  image = "/og-image.jpg",
  canonical = Astro.url.href,
  keywords = "mudanzas Barcelona, mudanzas profesionales, empresa mudanzas Barcelona, mudanzas baratas, presupuesto mudanza gratis, mudanzas particulares, mudanzas oficinas",
  robots = "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1",
  article,
} = Astro.props satisfies Props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Favicons generated from the truck logo -->
    <link rel="icon" href="/favicons/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-touch-icon.png"
    />
    <!-- SVG fallback / source of truth -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- Performance & Critical Resource Hints -->
    <!-- Preload hero images con media queries -->
    <link
      rel="preload"
      as="image"
      href="/camion/optimized/hero-fondo-mobile.avif"
      type="image/avif"
      media="(max-width: 768px)"
    />
    <link
      rel="preload"
      as="image"
      href="/camion/optimized/hero-fondo.avif"
      type="image/avif"
      media="(min-width: 769px)"
    />
    <link
      rel="preload"
      as="image"
      href="/camion/optimized/hero-fondo-mobile.webp"
      type="image/webp"
      media="(max-width: 768px)"
    />
    <link
      rel="preload"
      as="image"
      href="/camion/optimized/hero-fondo.webp"
      type="image/webp"
      media="(min-width: 769px)"
    />

    <!-- DNS prefetch para recursos externos -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />
    <link rel="dns-prefetch" href="//wa.me" />

    <!-- Preconnect para recursos crÃ­ticos -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://www.googletagmanager.com" />

    <!-- Resource hints para imÃ¡genes above-the-fold -->
    <link rel="prefetch" href="/camion/optimized/camion-frontal.webp" />
    <link rel="prefetch" href="/camion/optimized/camion-evening.webp" />

    <!-- Critical CSS inline para Above The Fold -->
    <style>
      /* Critical styles para hero section y layout base */
      html {
        scroll-padding-top: 5rem;
      }
      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
      }
      .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 1rem;
      }
      .relative {
        position: relative;
      }
      .absolute {
        position: absolute;
      }
      .inset-0 {
        inset: 0;
      }
      .z-0 {
        z-index: 0;
      }
      .z-10 {
        z-index: 10;
      }
      .w-full {
        width: 100%;
      }
      .h-full {
        height: 100%;
      }
      .object-cover {
        object-fit: cover;
      }
      .text-center {
        text-align: center;
      }
      .pt-20 {
        padding-top: 5rem;
      }
      .py-16 {
        padding: 4rem 0;
      }
      .mb-4 {
        margin-bottom: 1rem;
      }
      .mb-6 {
        margin-bottom: 1.5rem;
      }
      .overflow-hidden {
        overflow: hidden;
      }
      .bg-gradient-to-br {
        background-image: linear-gradient(
          to bottom right,
          var(--tw-gradient-stops)
        );
      }
      .from-\[rgb\(249\,180\,171\)\] {
        --tw-gradient-from: rgb(249, 180, 171);
        --tw-gradient-to: rgb(249 180 171 / 0);
        --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
      }
      .to-\[rgb\(187\,212\,206\)\] {
        --tw-gradient-to: rgb(187, 212, 206);
      }
      .text-brand {
        color: rgb(38, 78, 112);
      }
      .text-secondary {
        color: rgb(103, 145, 134);
      }
      .font-bold {
        font-weight: 700;
      }
      .font-semibold {
        font-weight: 600;
      }
      .leading-tight {
        line-height: 1.25;
      }
      .drop-shadow-sm {
        filter: drop-shadow(0 1px 1px rgb(0 0 0 / 0.05));
      }
      .opacity-15 {
        opacity: 0.15;
      }

      /* Responsive text sizes */
      .text-2xl {
        font-size: 1.5rem;
        line-height: 2rem;
      }
      .text-lg {
        font-size: 1.125rem;
        line-height: 1.75rem;
      }

      @media (min-width: 640px) {
        .sm\:text-3xl {
          font-size: 1.875rem;
          line-height: 2.25rem;
        }
        .sm\:text-xl {
          font-size: 1.25rem;
          line-height: 1.75rem;
        }
      }

      @media (min-width: 768px) {
        .md\:text-4xl {
          font-size: 2.25rem;
          line-height: 2.5rem;
        }
        .md\:text-2xl {
          font-size: 1.5rem;
          line-height: 2rem;
        }
      }

      @media (min-width: 1024px) {
        .lg\:text-5xl {
          font-size: 3rem;
          line-height: 1;
        }
        .lg\:text-3xl {
          font-size: 1.875rem;
          line-height: 2.25rem;
        }
        .lg\:py-20 {
          padding: 5rem 0;
        }
        .lg\:mb-6 {
          margin-bottom: 1.5rem;
        }
        .lg\:mb-8 {
          margin-bottom: 2rem;
        }
      }

      @media (min-width: 1280px) {
        .xl\:text-6xl {
          font-size: 3.75rem;
          line-height: 1;
        }
      }

      /* ============================================
         VIEW TRANSITIONS - ULTRA SIMPLE
         ============================================ */

      /* Solo fade bÃ¡sico para evitar problemas de scroll */
      ::view-transition-old(root) {
        animation-duration: 0.15s;
        animation-timing-function: ease-out;
      }

      ::view-transition-new(root) {
        animation-duration: 0.15s;
        animation-timing-function: ease-in;
      }

      /* Respeto por preferencias de movimiento reducido */
      @media (prefers-reduced-motion: reduce) {
        ::view-transition-old(root),
        ::view-transition-new(root) {
          animation-duration: 0.01s;
        }
      }
    </style>

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="robots" content={robots} />
    <link rel="canonical" href={canonical} />

    <!-- Additional SEO Meta Tags -->
    <meta name="author" content="Mudanzas ANDY" />
    <meta name="language" content="es" />
    <meta name="geo.region" content="ES-CT" />
    <meta name="geo.placename" content="Barcelona" />
    <meta name="geo.position" content="41.3851;2.1734" />
    <meta name="ICBM" content="41.3851, 2.1734" />

    <!-- Business Information -->
    <meta
      name="contact"
      content="mundanzas.andy@gmail.com, info@mudanzasandy.es"
    />
    <meta name="phone" content="+34933539792" />
    <meta
      name="address"
      content="Carrer de Casals i CuberÃ³, Barcelona, EspaÃ±a"
    />

    <!-- Search Engine Verification Tags -->
    {
      analyticsConfig.google.search_console.verification_code && (
        <meta
          name="google-site-verification"
          content={analyticsConfig.google.search_console.verification_code}
        />
      )
    }
    {
      analyticsConfig.bing.webmaster_tools.verification_code && (
        <meta
          name="msvalidate.01"
          content={analyticsConfig.bing.webmaster_tools.verification_code}
        />
      )
    }
    {
      analyticsConfig.meta.domain_verification && (
        <meta
          name="facebook-domain-verification"
          content={analyticsConfig.meta.domain_verification}
        />
      )
    }

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonical} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.url)} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:site_name" content="Mudanzas ANDY" />
    <meta property="og:locale" content="es_ES" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonical} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.url)} />
    <meta
      property="twitter:image:alt"
      content="Mudanzas ANDY - Empresa de mudanzas profesionales en Barcelona"
    />
    <meta property="twitter:site" content="@MudanzasAndy" />
    <meta property="twitter:creator" content="@MudanzasAndy" />

    <!-- Enhanced Schema.org markup for Moving Company -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "MovingCompany",
        name: "Mudanzas ANDY",
        alternateName: "ANDY Mudanzas Barcelona",
        description:
          "Empresa de mudanzas profesionales en Barcelona y EspaÃ±a. Servicios de mudanzas particulares, oficinas, embalaje profesional y traslado a guardamuebles/trasteros.",
        url: canonical,
        logo: new URL("/logo-mudanzas-andy.svg", Astro.url),
        image: new URL(image, Astro.url),
        telephone: "+34933539792",
        email: ["mundanzas.andy@gmail.com", "info@mudanzasandy.es"],
        foundingDate: "2010",
        slogan: "Tu mudanza, nuestra prioridad",
        address: {
          "@type": "PostalAddress",
          streetAddress: "Carrer de Casals i CuberÃ³",
          addressLocality: "Barcelona",
          addressRegion: "CataluÃ±a",
          postalCode: "08016",
          addressCountry: "ES",
        },
        geo: {
          "@type": "GeoCoordinates",
          latitude: "41.3851",
          longitude: "2.1734",
        },
        openingHours: "Mo-Su 00:00-23:59",
        priceRange: "â‚¬â‚¬",
        currenciesAccepted: "EUR",
        paymentAccepted: ["Cash", "Credit Card", "Bank Transfer"],
        serviceArea: [
          {
            "@type": "Country",
            name: "EspaÃ±a",
          },
          {
            "@type": "AdministrativeArea",
            name: "CataluÃ±a",
          },
          {
            "@type": "City",
            name: "Barcelona",
          },
        ],
        areaServed: ["Barcelona", "Madrid", "Valencia", "CataluÃ±a", "EspaÃ±a"],
        hasOfferCatalog: {
          "@type": "OfferCatalog",
          name: "Servicios de Mudanzas",
          itemListElement: [
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: "Mudanzas Particulares",
                description:
                  "Mudanzas de viviendas completas con embalaje profesional incluido",
              },
            },
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: "Mudanzas de Oficinas",
                description:
                  "Traslados empresariales con mÃ­nima interrupciÃ³n del negocio",
              },
            },
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: "Embalaje Profesional",
                description:
                  "Servicio completo de embalaje con materiales de alta calidad",
              },
            },
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: "Guardamuebles",
                description: "Almacenamiento seguro temporal de pertenencias",
              },
            },
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: "Mudanzas Express",
                description: "Mudanzas urgentes realizadas en el mismo dÃ­a",
              },
            },
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: "Mudanzas Nacionales",
                description:
                  "Mudanzas por toda EspaÃ±a con seguimiento en tiempo real",
              },
            },
          ],
        },
        review: [
          {
            "@type": "Review",
            author: {
              "@type": "Person",
              name: "MarÃ­a GarcÃ­a",
            },
            reviewRating: {
              "@type": "Rating",
              ratingValue: 5,
              bestRating: 5,
            },
            reviewBody:
              "Profesionales, puntuales y muy cuidadosos. Mi mudanza fue perfecta y sin estrÃ©s.",
          },
          {
            "@type": "Review",
            author: {
              "@type": "Person",
              name: "Carlos Ruiz",
            },
            reviewRating: {
              "@type": "Rating",
              ratingValue: 5,
              bestRating: 5,
            },
            reviewBody:
              "Trasladaron toda nuestra oficina en un fin de semana. El lunes ya estÃ¡bamos trabajando normalmente.",
          },
          {
            "@type": "Review",
            author: {
              "@type": "Person",
              name: "Ana LÃ³pez",
            },
            reviewRating: {
              "@type": "Rating",
              ratingValue: 5,
              bestRating: 5,
            },
            reviewBody:
              "En menos de 4 horas habÃ­an terminado. Todo perfectamente organizado y sin un solo rasguÃ±o.",
          },
        ],
        aggregateRating: {
          "@type": "AggregateRating",
          ratingValue: 5.0,
          reviewCount: 3,
          bestRating: 5,
          worstRating: 1,
        },
        contactPoint: [
          {
            "@type": "ContactPoint",
            telephone: "+34933539792",
            contactType: "customer service",
            areaServed: "ES",
            availableLanguage: "Spanish",
          },
          {
            "@type": "ContactPoint",
            telephone: "+34640506084",
            contactType: "customer service",
            contactOption: "WhatsApp",
            areaServed: "ES",
            availableLanguage: "Spanish",
          },
        ],
        sameAs: ["https://wa.me/34640506084"],
      })}
    />

    <!-- Website Schema -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebSite",
        name: "Mudanzas ANDY",
        url: canonical,
        potentialAction: {
          "@type": "SearchAction",
          target: canonical + "?q={search_term_string}",
          "query-input": "required name=search_term_string",
        },
      })}
    />

    <!-- Breadcrumb Schema (for pages with navigation) -->
    {
      Astro.url.pathname !== "/" && (
        <script
          type="application/ld+json"
          is:inline
          set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            itemListElement: [
              {
                "@type": "ListItem",
                position: 1,
                name: "Inicio",
                item: new URL("/", Astro.url).href,
              },
              {
                "@type": "ListItem",
                position: 2,
                name: title,
                item: canonical,
              },
            ],
          })}
        />
      )
    }

    <!-- Google Tag Manager (head) -->
    {
      analyticsConfig.google.tag_manager.container_id && (
        <script
          is:inline
          set:html={`
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','${analyticsConfig.google.tag_manager.container_id}');
      `}
        />
      )
    }

    <!-- Google Analytics 4 -->
    {
      analyticsConfig.google.analytics.measurement_id && (
        <>
          <script
            async
            src={`https://www.googletagmanager.com/gtag/js?id=${analyticsConfig.google.analytics.measurement_id}`}
          />
          <script
            is:inline
            set:html={`
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', '${analyticsConfig.google.analytics.measurement_id}', {
            page_title: '${title}',
            page_location: '${canonical}',
            anonymize_ip: true,
            cookie_flags: 'secure;samesite=lax'
          });
        `}
          />
        </>
      )
    }

    <!-- View Transitions para navegaciÃ³n suave -->
    <ViewTransitions />

    <!-- Estilos personalizados para view transitions -->
    <style>
      /* View Transitions personalizadas */
      @media (prefers-reduced-motion: no-preference) {
        ::view-transition-old(root),
        ::view-transition-new(root) {
          animation-duration: 0.3s;
          animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        ::view-transition-old(root) {
          animation-name: slide-out-left;
        }

        ::view-transition-new(root) {
          animation-name: slide-in-right;
        }

        @keyframes slide-out-left {
          from {
            transform: translateX(0);
            opacity: 1;
          }
          to {
            transform: translateX(-30px);
            opacity: 0;
          }
        }

        @keyframes slide-in-right {
          from {
            transform: translateX(30px);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        /* TransiciÃ³n especÃ­fica para el blog */
        [data-astro-transition-scope="blog"] {
          view-transition-name: blog-content;
        }

        ::view-transition-old(blog-content),
        ::view-transition-new(blog-content) {
          animation-duration: 0.4s;
        }

        ::view-transition-old(blog-content) {
          animation-name: fade-scale-out;
        }

        ::view-transition-new(blog-content) {
          animation-name: fade-scale-in;
        }

        @keyframes fade-scale-out {
          from {
            transform: scale(1);
            opacity: 1;
          }
          to {
            transform: scale(0.95);
            opacity: 0;
          }
        }

        @keyframes fade-scale-in {
          from {
            transform: scale(1.05);
            opacity: 0;
          }
          to {
            transform: scale(1);
            opacity: 1;
          }
        }
      }

      /* Animaciones suaves para scroll interno */
      html {
        scroll-behavior: smooth;
      }
    </style>
  </head>
  <body class="font-sans bg-[#fdebd3] text-gray-800 antialiased">
    <!-- Google Tag Manager (noscript) -->
    {
      analyticsConfig.google.tag_manager.container_id && (
        <noscript>
          <iframe
            src={`https://www.googletagmanager.com/ns.html?id=${analyticsConfig.google.tag_manager.container_id}`}
            height="0"
            width="0"
            style="display:none;visibility:hidden"
          />
        </noscript>
      )
    }

    <slot />

    <!-- Cookie Banner -->
    <CookieBanner />

    <!-- WhatsApp Floating Button (visible during scroll; script will toggle visibility when footer is in view) -->
    <a
      href="https://wa.me/34640506084"
      target="_blank"
      rel="noopener noreferrer"
      id="reserva-ya-floating"
      class="fixed bottom-20 sm:bottom-24 lg:bottom-28 right-4 z-40 bg-[#FAE360] hover:bg-[#f0d84a] text-[#264e70] font-bold py-3 px-4 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 flex items-center gap-2 animate-pulse hover:animate-none"
      aria-label="Contactar por WhatsApp"
    >
      <span class="text-2xl">ðŸ’¬</span>
      <span class="hidden lg:inline">Â¡Reserva YA!</span>
      <span class="text-sm font-normal">640 50 60 84</span>
    </a>

    <!-- External script toggles floating/footer Reserva button visibility -->
    <script src="/js/move-reserva.js" defer is:inline></script>
    <!-- Print ASCII credit to dev console when DevTools opens -->
    <script is:inline>
      (function () {
        // Build block letters for 'jOrGe' with mixed case
        const j = ["    _ ", "   (_)", "    | ", " _  | ", "(_)_/ ", "      "];
        const O = [
          " _____ ",
          "|  _  |",
          "| | | |",
          "| |_| |",
          "|_____|",
          "       ",
        ];
        const r = ["      ", " _ __ ", "| '__|", "| |   ", "|_|   ", "      "];
        const G = [
          " _____ ",
          "|  ___|",
          "| |  _ ",
          "| |_| |",
          "|_____|",
          "       ",
        ];
        const e = ["      ", " ___  ", "|  _| ", "| |__ ", "|____|", "      "];

        const gap = " ";
        const lines = [];
        for (let k = 0; k < j.length; k++) {
          lines.push(j[k] + gap + O[k] + gap + r[k] + gap + G[k] + gap + e[k]);
        }
        const art = lines.join("\n") + "\n\n    jOrGe  jordi.nodejs@gmail.com";

        const style =
          "color:#264e70; font-weight:700; font-family:monospace; font-style:italic; font-size:12px;";

        let printed = false;
        function printOnce() {
          if (printed) return;
          console.log("%c" + art, style);
          printed = true;
        }

        // Heuristic detection of DevTools
        const CHECK_INTERVAL_MS = 800;
        const THRESHOLD = 160;

        function checkDevTools() {
          try {
            const widthDiff = window.outerWidth - window.innerWidth;
            const heightDiff = window.outerHeight - window.innerHeight;
            const open = widthDiff > THRESHOLD || heightDiff > THRESHOLD;
            if (open) printOnce();
          } catch (e) {
            // ignore
          }
        }

        setTimeout(checkDevTools, 200);
        const id = setInterval(function () {
          if (printed) return clearInterval(id);
          checkDevTools();
        }, CHECK_INTERVAL_MS);
      })();
    </script>
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
