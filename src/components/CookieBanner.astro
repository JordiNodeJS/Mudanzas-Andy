---
// Cookie Banner Component - RGPD Compliant
---

<!-- Banner ultra-fino de una l√≠nea - Aceptaci√≥n cookies/pol√≠ticas -->
<div
  id="cookie-banner"
  class="fixed top-0 left-0 right-0 bg-[rgb(var(--color-primary))] text-white text-center py-2 shadow-sm z-[9999] transition-transform duration-300 ease-in-out"
  style="display: none; transform: translateY(-100%);"
>
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-center gap-6 text-sm">
      <!-- Mensaje ultra-compacto -->
      <span class="text-white">
        üç™ Utilizamos cookies esenciales. Al continuar navegando, aceptas
        nuestras
        <a
          href="/politica-privacidad"
          class="underline hover:opacity-80 font-medium"
          >Pol√≠ticas de Privacidad</a
        > y
        <a
          href="/politica-cookies"
          class="underline hover:opacity-80 font-medium">Cookies</a
        >.
      </span>

      <!-- Bot√≥n de aceptar simple -->
      <button
        id="cookie-accept-btn"
        class="bg-white/20 hover:bg-white/30 text-white px-4 py-1 rounded text-xs font-medium transition-colors whitespace-nowrap"
      >
        ‚úÖ Entendido
      </button>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div
  id="cookie-settings-modal"
  class="fixed inset-0 bg-black bg-opacity-50 z-[50000] hidden"
>
  <div class="flex items-center justify-center min-h-screen p-4">
    <div
      class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto"
    >
      <div class="p-6">
        <!-- Modal Header -->
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-brand">
            Configuraci√≥n de Cookies
          </h2>
          <button
            id="cookie-modal-close"
            class="text-gray-500 hover:text-gray-700"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <!-- Modal Content -->
        <div class="space-y-6">
          <p class="text-gray-700">
            Este sitio web utiliza √∫nicamente cookies t√©cnicas esenciales para
            su funcionamiento. Estas cookies son necesarias y no pueden
            desactivarse.
          </p>

          <!-- Technical Cookies -->
          <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-bold text-brand">üîß Cookies T√©cnicas</h3>
              <div
                class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-medium"
              >
                Siempre activas
              </div>
            </div>
            <p class="text-sm text-gray-600 mb-3">
              Esenciales para el funcionamiento b√°sico del sitio web. Incluyen
              cookies de seguridad, gesti√≥n de sesi√≥n y funcionamiento b√°sico.
            </p>
            <div class="text-xs text-gray-500">
              <strong>Cookies:</strong> cookie-consent, sesi√≥n del sitio, seguridad
              CSRF
            </div>
          </div>

          <!-- Action Buttons -->
          <div
            class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200"
          >
            <button
              id="accept-all-cookies"
              class="flex-1 bg-brand text-white px-6 py-3 rounded-lg hover:bg-opacity-90 transition-colors font-medium"
            >
              ‚úÖ Aceptar
            </button>
            <button
              id="reject-all-cookies"
              class="flex-1 border border-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium"
            >
              ‚ùå Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  // Cookie Banner Management
  (function () {
    "use strict";

    const COOKIE_NAME = "cookie-consent";
    const COOKIE_DURATION = 365;

    // Utility functions
    function setCookie(name, value, days) {
      const expires = new Date(Date.now() + days * 864e5).toUTCString();
      document.cookie =
        name +
        "=" +
        value +
        "; expires=" +
        expires +
        "; path=/; SameSite=Strict";
    }

    function getCookie(name) {
      const value = "; " + document.cookie;
      const parts = value.split("; " + name + "=");
      if (parts.length === 2) {
        const part = parts.pop();
        return part ? part.split(";").shift() || null : null;
      }
      return null;
    }

    function deleteCookie(name) {
      document.cookie =
        name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }

    // No analytics - only technical cookies

    // Banner management - Ahora desde arriba
    function showBanner() {
      const banner = document.getElementById("cookie-banner");
      if (banner) {
        banner.style.display = "block";
        document.body.classList.add("cookie-banner-visible");
        // Peque√±o delay para que la transici√≥n se vea bien
        setTimeout(function () {
          banner.style.transform = "translateY(0)";
        }, 50);
      }
    }

    function hideBanner() {
      const banner = document.getElementById("cookie-banner");
      if (banner) {
        banner.style.transform = "translateY(-100%)";
        setTimeout(function () {
          banner.style.display = "none";
          document.body.classList.remove("cookie-banner-visible");
        }, 300);
      }
    }

    // Modal management (not used anymore but kept for compatibility)
    function showModal() {
      const modal = document.getElementById("cookie-settings-modal");
      if (modal) {
        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      }
    }

    function hideModal() {
      const modal = document.getElementById("cookie-settings-modal");
      if (modal) {
        modal.classList.add("hidden");
        document.body.style.overflow = "";
      }
    }

    // Consent management
    function acceptAllCookies() {
      setCookie(COOKIE_NAME, "accepted", COOKIE_DURATION);
      hideBanner();
      hideModal();
    }

    function _rejectAllCookies() {
      // kept for backward compatibility; intentionally unused in current flow
      setCookie(COOKIE_NAME, "rejected", COOKIE_DURATION);
      hideBanner();
      hideModal();
    }

    // Expose for backward compatibility and to avoid unused-variable diagnostics
    // Consumers / legacy scripts can call `window._rejectAllCookies()` if needed.
    window._rejectAllCookies = _rejectAllCookies;

    // Initialize - Versi√≥n simplificada
    function init() {
      const consent = getCookie(COOKIE_NAME);

      // Mostrar banner simple si no hay consentimiento
      if (!consent) {
        setTimeout(() => {
          showBanner();
        }, 300);
      }

      // Event listener simple - solo bot√≥n de aceptar del banner
      const acceptBtn = document.getElementById("cookie-accept-btn");
      if (acceptBtn) {
        acceptBtn.addEventListener("click", function () {
          acceptAllCookies();
        });
      }

      // Event listeners para el modal
      const modalAcceptBtn = document.getElementById("accept-all-cookies");
      if (modalAcceptBtn) {
        modalAcceptBtn.addEventListener("click", function () {
          acceptAllCookies();
        });
      }

      const modalRejectBtn = document.getElementById("reject-all-cookies");
      if (modalRejectBtn) {
        modalRejectBtn.addEventListener("click", function () {
          hideModal();
        });
      }

      const modalCloseBtn = document.getElementById("cookie-modal-close");
      if (modalCloseBtn) {
        modalCloseBtn.addEventListener("click", function () {
          hideModal();
        });
      }

      // Close modal when clicking outside (si existe)
      const modal = document.getElementById("cookie-settings-modal");
      if (modal) {
        modal.addEventListener("click", function (e) {
          if (e.target === modal) {
            hideModal();
          }
        });
      }

      // Global function for cookie settings
      window.showCookieSettings = showModal;

      // Event listener para el bot√≥n "Configurar Cookies" del footer
      const footerCookieBtn = document.getElementById("footer-cookie-settings");
      if (footerCookieBtn) {
        footerCookieBtn.addEventListener("click", function () {
          showModal();
        });
      }

      // Function para testing/debug - resetear cookies y mostrar banner
      window.testCookieBanner = function () {
        deleteCookie(COOKIE_NAME);
        setTimeout(() => {
          showBanner();
        }, 100);
        console.log("üç™ Banner de cookies reseteado y mostrado para testing");
      };
    }

    // Run initialization when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  })();
</script>

<style>
  /* Banner ultra-fino - Estilos simplificados */
  #cookie-banner {
    background: rgb(var(--color-primary));
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
    height: auto;
    min-height: 40px;
  }

  #cookie-banner.show {
    transform: translateY(0) !important;
  }

  /* Enlaces dentro del banner */
  #cookie-banner a {
    color: white;
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
    transition: opacity 0.2s ease;
  }

  #cookie-banner a:hover {
    opacity: 0.8;
    text-decoration-thickness: 2px;
  }

  /* Bot√≥n simple de aceptar */
  #cookie-accept-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: all 0.2s ease;
  }

  #cookie-accept-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    border-color: rgba(255, 255, 255, 0.5);
  }

  /* Animaci√≥n de entrada m√°s suave */
  #cookie-banner {
    animation: slideInFromTop 0.5s ease-out forwards;
  }

  @keyframes slideInFromTop {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Animaci√≥n sutil de atenci√≥n despu√©s de aparecer */
  @keyframes gentle-bounce {
    0%,
    100% {
      transform: translateY(0);
    }
    25% {
      transform: translateY(-3px);
    }
    50% {
      transform: translateY(0);
    }
    75% {
      transform: translateY(-2px);
    }
  }

  /* Modal Responsive Improvements */
  @media (max-width: 640px) {
    #cookie-settings-modal .flex {
      flex-direction: column;
    }

    #cookie-settings-modal .flex-1 {
      width: 100%;
    }

    /* En m√≥vil, hacer el banner a√∫n m√°s compacto */
    #cookie-banner {
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }

    #cookie-banner .flex {
      flex-direction: column;
      gap: 0.5rem;
      align-items: stretch;
    }

    #cookie-banner .shrink-0 {
      flex-shrink: 1;
    }
  }

  /* Accessibility improvements */
  @media (prefers-reduced-motion: reduce) {
    #cookie-banner {
      transition: none;
    }

    #cookie-more-info,
    #cookie-banner button {
      transition: none;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    #cookie-banner {
      border-bottom: 2px solid #fff;
      background: #000 !important;
    }

    #cookie-banner button {
      border-width: 2px;
      border-color: #fff;
    }

    #cookie-more-info {
      color: #fff;
      text-decoration-color: #fff;
    }
  }

  /* Compensar el espacio del banner ultra-fino */
  body.cookie-banner-visible {
    padding-top: 40px; /* Altura m√≠nima del banner fino */
  }

  @media (max-width: 640px) {
    body.cookie-banner-visible {
      padding-top: 45px; /* Poco m√°s de espacio en m√≥vil */
    }
  }
</style>
