---
// Componente de imagen hero ultra-optimizado para LCP perfecto
interface Props {
  src: string;
  alt: string;
  priority?: boolean;
  sizes?: string;
  quality?: number;
}

const {
  src,
  alt,
  priority = false,
  sizes = "(max-width: 768px) 100vw, 80vw",
  quality = 85,
} = Astro.props satisfies Props;

// Optimización: Generar todas las variantes de formato y tamaño
const variants = {
  mobile: {
    avif: `/camion/optimized/${src}-mobile.avif`,
    webp: `/camion/optimized/${src}-mobile.webp`,
    jpg: `/camion/optimized/${src}-mobile.jpg`,
  },
  desktop: {
    avif: `/camion/optimized/${src}.avif`,
    webp: `/camion/optimized/${src}.webp`,
    jpg: `/camion/optimized/${src}.jpg`,
  },
};
---

<!-- Picture element ultra-optimizado para Core Web Vitals perfectos -->
<picture>
  <!-- AVIF móvil (formato más eficiente) -->
  <source
    media="(max-width: 768px)"
    srcset={variants.mobile.avif}
    type="image/avif"
  />

  <!-- WebP móvil (fallback moderno) -->
  <source
    media="(max-width: 768px)"
    srcset={variants.mobile.webp}
    type="image/webp"
  />

  <!-- AVIF desktop -->
  <source
    media="(min-width: 769px)"
    srcset={variants.desktop.avif}
    type="image/avif"
  />

  <!-- WebP desktop -->
  <source
    media="(min-width: 769px)"
    srcset={variants.desktop.webp}
    type="image/webp"
  />

  <!-- Imagen base optimizada con atributos críticos para LCP -->
  <img
    src={variants.desktop.jpg}
    alt={alt}
    width="1200"
    height="600"
    sizes={sizes}
    loading={priority ? "eager" : "lazy"}
    decoding={priority ? "sync" : "async"}
    fetchpriority={priority ? "high" : "auto"}
    style="aspect-ratio: 2/1; object-fit: cover; width: 100%; height: auto; max-width: 100%;"
    class="w-full h-auto"
  />
</picture>

<!-- CSS crítico inline para prevenir layout shifts -->
<style>
  picture {
    display: block;
    width: 100%;
    contain: layout style paint;
  }

  picture img {
    display: block;
    width: 100%;
    height: auto;
    /* Aspect ratio crítico para prevenir CLS */
    aspect-ratio: 2/1;
    object-fit: cover;
    /* Optimización para rendering */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }

  /* Optimización para diferentes densidades de pixel */
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    picture img {
      image-rendering: -webkit-optimize-contrast;
    }
  }
</style>
