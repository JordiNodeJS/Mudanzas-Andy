---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const pageTitle = "Blog - Mudanzas ANDY";
const pageDescription =
  "Art√≠culos, consejos y noticias sobre mudanzas profesionales. Todo lo que necesitas saber para tu pr√≥xima mudanza con Mudanzas ANDY.";
---

<Layout
  title={pageTitle}
  description={pageDescription}
  image="/logos/logo-mudanzas-andy.svg"
  canonical="https://mudanzasandy.es/blog-astro/"
>
  <!-- Header fijo -->
  <Header />

  <main
    class="pt-20 md:pt-24 lg:pt-28 bg-gray-50"
    data-astro-transition-scope="blog"
  >
    <!-- T√≠tulo de la secci√≥n -->
    <section class="bg-brand text-white pt-16 pb-3 lg:py-12 lg:pb-2">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <h1 class="text-3xl lg:text-4xl font-bold text-highlight mb-4">
            üìù Blog de Mudanzas ANDY
          </h1>
          <p class="text-lg text-neutral max-w-2xl mx-auto">
            Consejos, gu√≠as y art√≠culos sobre mudanzas profesionales para hacer
            tu traslado m√°s f√°cil
          </p>
        </div>
      </div>
    </section>

    <!-- Contenedor del iframe del blog -->
    <section class="bg-white">
      <div class="w-full" id="blog-container">
        <!-- Mensaje de fallback si el iframe no carga -->
        <div
          id="iframe-fallback"
          class="hidden text-center p-8 bg-blue-50 border border-blue-200 rounded-lg m-4"
        >
          <div class="max-w-2xl mx-auto">
            <h3 class="text-xl font-semibold text-brand mb-4">
              üìù Accede a nuestro Blog
            </h3>
            <p class="text-gray-700 mb-6">
              Nuestro blog contiene art√≠culos √∫tiles sobre mudanzas, consejos
              profesionales y gu√≠as pr√°cticas. Por motivos de seguridad, el
              contenido se debe visualizar en una ventana separada.
            </p>
            <div class="space-y-4">
              <a
                href="https://blog.mudanzasandy.es/"
                target="_blank"
                rel="noopener noreferrer"
                class="blog-cta-button inline-flex items-center gap-3 bg-brand text-white px-6 py-3 rounded-lg hover:bg-brand/90 transition-all duration-300 font-medium group"
              >
                <span
                  class="rocket-icon text-xl transition-transform duration-300 group-hover:translate-x-1"
                  >üöÄ</span
                >
                <span>Visitar nuestro Blog</span>
                <span class="text-xs opacity-75">(Nueva ventana)</span>
              </a>

              <div class="text-sm text-gray-600">
                <p class="mb-2">
                  üìö <strong>En nuestro blog encontrar√°s:</strong>
                </p>
                <ul class="text-left max-w-md mx-auto space-y-1">
                  <li>‚Ä¢ Consejos para organizar tu mudanza</li>
                  <li>‚Ä¢ Gu√≠as de embalaje profesional</li>
                  <li>‚Ä¢ Tips para ahorrar en tu mudanza</li>
                  <li>‚Ä¢ Noticias del sector</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Iframe del blog (intentar√° cargar primero) -->
        <iframe
          id="blog-iframe"
          src="https://blog.mudanzasandy.es/"
          class="w-full border-0"
          style="height: 800px; min-height: 600px;"
          title="Blog Mudanzas ANDY"
          loading="lazy"
          sandbox="allow-same-origin allow-scripts allow-forms allow-top-navigation allow-popups"
        ></iframe>
      </div>
    </section>

    <!-- Enlace directo al blog original -->
    <section class="bg-white py-6 border-t">
      <div class="container mx-auto px-4 text-center">
        <p class="text-gray-600 text-sm mb-2">
          ¬øPrefieres ver el blog en una ventana separada?
        </p>
        <a
          href="https://blog.mudanzasandy.es/"
          target="_blank"
          rel="noopener noreferrer"
          class="blog-external-link inline-flex items-center gap-2 bg-brand text-white px-4 py-2 rounded-lg hover:bg-brand/90 transition-all duration-300 transform hover:scale-105 hover:shadow-lg group"
        >
          <span
            class="rocket-icon text-sm transition-transform duration-300 group-hover:rotate-12"
            >üöÄ</span
          >
          <span>Abrir blog en nueva ventana</span>
        </a>
      </div>
    </section>
  </main>
</Layout>

<!-- Footer -->
<Footer />

<style>
  /* Estilos adicionales para el iframe */
  iframe {
    display: block;
    width: 100%;
    border: none;
    overflow: hidden;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    iframe {
      height: 600px !important;
      min-height: 500px;
    }
  }

  @media (max-width: 480px) {
    iframe {
      height: 500px !important;
      min-height: 400px;
    }
  }

  /* Loading state */
  iframe::before {
    content: "Cargando blog...";
    display: block;
    text-align: center;
    padding: 2rem;
    color: #666;
    font-family: system-ui, sans-serif;
  }

  /* üé® Animaciones mejoradas para enlaces del blog */
  .blog-cta-button {
    position: relative;
    overflow: hidden;
    background: linear-gradient(
      135deg,
      rgb(var(--color-primary)),
      rgb(var(--color-secondary))
    );
    box-shadow: 0 4px 15px rgba(var(--color-primary), 0.3);
    border: 2px solid transparent;
    background-clip: padding-box;
  }

  .blog-cta-button::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent
    );
    transition: left 0.5s ease;
  }

  .blog-cta-button:hover::before {
    left: 100%;
  }

  .blog-cta-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(var(--color-primary), 0.4);
    background: linear-gradient(
      135deg,
      rgb(var(--color-secondary)),
      rgb(var(--color-primary))
    );
  }

  .blog-cta-button:active {
    transform: translateY(0);
    transition: transform 0.1s ease;
  }

  /* Animaci√≥n espec√≠fica para el enlace externo */
  .blog-external-link {
    background: linear-gradient(
      45deg,
      rgb(var(--color-primary)),
      rgb(var(--color-accent))
    );
    position: relative;
    overflow: hidden;
  }

  .blog-external-link::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition:
      width 0.6s ease,
      height 0.6s ease;
  }

  .blog-external-link:hover::after {
    width: 300px;
    height: 300px;
  }

  .blog-external-link:hover {
    background: linear-gradient(
      45deg,
      rgb(var(--color-accent)),
      rgb(var(--color-highlight))
    );
    color: rgb(var(--color-primary));
    font-weight: 600;
  }

  /* Animaci√≥n de pulso para llamar la atenci√≥n */
  @keyframes gentle-pulse {
    0%,
    100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.05);
      opacity: 0.9;
    }
  }

  .blog-cta-button:focus {
    animation: gentle-pulse 2s infinite;
    outline: 3px solid rgba(var(--color-highlight), 0.5);
    outline-offset: 2px;
  }

  /* Animaci√≥n de rebote suave para los iconos */
  @keyframes bounce-soft {
    0%,
    20%,
    50%,
    80%,
    100% {
      transform: translateY(0) rotate(0deg);
    }
    40% {
      transform: translateY(-3px) rotate(5deg);
    }
    60% {
      transform: translateY(-1px) rotate(-2deg);
    }
  }

  .rocket-icon {
    display: inline-block;
  }

  .blog-cta-button:hover .rocket-icon {
    animation: bounce-soft 0.6s ease;
  }

  /* Efecto de highlight en la lista del fallback */
  .text-left li {
    transition: all 0.3s ease;
    padding: 0.25rem 0;
    border-radius: 4px;
  }

  .text-left li:hover {
    background: rgba(var(--color-highlight), 0.1);
    transform: translateX(5px);
    color: rgb(var(--color-primary));
    font-weight: 500;
  }

  /* Transici√≥n suave para el contenedor del fallback */
  #iframe-fallback {
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateY(10px);
    opacity: 0;
  }

  #iframe-fallback:not(.hidden) {
    transform: translateY(0);
    opacity: 1;
  }
</style>

<script>
  // Script mejorado para detectar errores reales de iframe
  document.addEventListener("DOMContentLoaded", function () {
    const iframe = document.getElementById("blog-iframe") as HTMLIFrameElement;
    const fallbackDiv = document.getElementById("iframe-fallback");

    if (iframe && fallbackDiv) {
      let fallbackShown = false;
      let iframeLoaded = false;

      // Funci√≥n para mostrar el fallback
      function showFallback() {
        if (!fallbackShown && fallbackDiv) {
          fallbackShown = true;
          iframe.style.display = "none";
          fallbackDiv.classList.remove("hidden");
          console.log("Mostrando p√°gina de fallback para el blog");
        }
      }

      // Detectar cuando el iframe se carga exitosamente
      iframe.addEventListener("load", function () {
        console.log("Iframe del blog cargado exitosamente");
        iframeLoaded = true;
      });

      // Detectar errores de carga del iframe
      iframe.addEventListener("error", function () {
        console.error("Error al cargar el iframe del blog");
        showFallback();
      });

      // Interceptar errores de consola relacionados con X-Frame-Options
      const originalConsoleError = console.error;
      console.error = function (...args: any[]) {
        const message = args.join(" ").toLowerCase();
        if (
          message.includes("x-frame-options") ||
          message.includes("refused to display") ||
          message.includes("frame because it set")
        ) {
          console.error("Detectado error X-Frame-Options:", ...args);
          showFallback();
        }
        originalConsoleError.apply(console, args);
      };

      // Solo usar timeout como √∫ltimo recurso si no hay carga tras bastante tiempo
      // Y solo si no hemos detectado una carga exitosa
      setTimeout(() => {
        if (!iframeLoaded && !fallbackShown) {
          console.warn(
            "Iframe no se ha cargado despu√©s de 8 segundos - posibles restricciones"
          );
          showFallback();
        }
      }, 8000); // Timeout m√°s largo y solo si no hay carga
    }

    // üé® Animaciones adicionales para mejorar la experiencia
    initEnhancedAnimations();
  });

  // Funci√≥n para inicializar animaciones mejoradas
  function initEnhancedAnimations() {
    // Animaci√≥n de entrada para elementos del fallback
    const observerOptions: IntersectionObserverInit = {
      threshold: 0.1,
      rootMargin: "0px 0px -50px 0px",
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const target = entry.target as HTMLElement;
          target.style.animation = "slideInUp 0.6s ease-out forwards";
        }
      });
    }, observerOptions);

    // Observar elementos del fallback cuando aparezcan
    setTimeout(() => {
      const fallbackElements = document.querySelectorAll(
        "#iframe-fallback h3, #iframe-fallback p, #iframe-fallback .blog-cta-button, #iframe-fallback ul"
      );
      fallbackElements.forEach((el, index) => {
        const element = el as HTMLElement;
        element.style.opacity = "0";
        element.style.transform = "translateY(20px)";
        element.style.animationDelay = `${index * 0.1}s`;
        observer.observe(element);
      });
    }, 100);

    // Efecto de part√≠culas sutiles en hover para botones principales
    const blogButtons = document.querySelectorAll(
      ".blog-cta-button, .blog-external-link"
    );
    blogButtons.forEach((button) => {
      button.addEventListener("mouseenter", createSparkleEffect);
      button.addEventListener("mouseleave", removeSparkleEffect);
    });

    function createSparkleEffect(e: Event) {
      const button = e.currentTarget as HTMLElement;
      const rect = button.getBoundingClientRect();

      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          const sparkle = document.createElement("div");
          sparkle.className = "sparkle";
          sparkle.style.cssText = `
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(var(--color-highlight), 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 10;
            top: ${Math.random() * rect.height}px;
            left: ${Math.random() * rect.width}px;
            animation: sparkleFloat 1s ease-out forwards;
          `;

          button.style.position = "relative";
          button.appendChild(sparkle);

          setTimeout(() => sparkle.remove(), 1000);
        }, i * 100);
      }
    }

    function removeSparkleEffect(e: Event) {
      const button = e.currentTarget as HTMLElement;
      const sparkles = button.querySelectorAll(".sparkle");
      sparkles.forEach((sparkle: Element) => sparkle.remove());
    }

    // Agregar keyframes din√°micos para las animaciones
    const style = document.createElement("style");
    style.textContent = `
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes sparkleFloat {
        0% {
          opacity: 0;
          transform: translateY(0) scale(0);
        }
        50% {
          opacity: 1;
          transform: translateY(-10px) scale(1);
        }
        100% {
          opacity: 0;
          transform: translateY(-20px) scale(0);
        }
      }
    `;
    document.head.appendChild(style);
  }
</script>
