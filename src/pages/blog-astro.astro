---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const pageTitle = "Blog - Mudanzas ANDY";
const pageDescription =
  "Art√≠culos, consejos y noticias sobre mudanzas profesionales. Todo lo que necesitas saber para tu pr√≥xima mudanza con Mudanzas ANDY.";
---

<Layout
  title={pageTitle}
  description={pageDescription}
  image="/logos/logo-mudanzas-andy.svg"
>
  <!-- Header fijo -->
  <Header />

  <main class="pt-20 md:pt-24 lg:pt-28 bg-gray-50">
    <!-- T√≠tulo de la secci√≥n -->
    <section class="bg-brand text-white pt-16 pb-3 lg:py-12 lg:pb-2">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <h1 class="text-3xl lg:text-4xl font-bold text-highlight mb-4">
            üìù Blog de Mudanzas ANDY
          </h1>
          <p class="text-lg text-neutral max-w-2xl mx-auto">
            Consejos, gu√≠as y art√≠culos sobre mudanzas profesionales para hacer
            tu traslado m√°s f√°cil
          </p>
        </div>
      </div>
    </section>

    <!-- Contenedor del iframe del blog -->
    <section class="bg-white">
      <div class="w-full" id="blog-container">
        <!-- Mensaje de fallback si el iframe no carga -->
        <div
          id="iframe-fallback"
          class="hidden text-center p-8 bg-blue-50 border border-blue-200 rounded-lg m-4"
        >
          <div class="max-w-2xl mx-auto">
            <h3 class="text-xl font-semibold text-brand mb-4">
              üìù Accede a nuestro Blog
            </h3>
            <p class="text-gray-700 mb-6">
              Nuestro blog contiene art√≠culos √∫tiles sobre mudanzas, consejos
              profesionales y gu√≠as pr√°cticas. Por motivos de seguridad, el
              contenido se debe visualizar en una ventana separada.
            </p>
            <div class="space-y-4">
              <a
                href="https://blog.mudanzasandy.es/"
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-3 bg-brand text-white px-6 py-3 rounded-lg hover:bg-brand/90 transition-colors font-medium"
              >
                <span>üöÄ</span>
                <span>Visitar nuestro Blog</span>
                <span class="text-xs opacity-75">(Nueva ventana)</span>
              </a>

              <div class="text-sm text-gray-600">
                <p class="mb-2">
                  üìö <strong>En nuestro blog encontrar√°s:</strong>
                </p>
                <ul class="text-left max-w-md mx-auto space-y-1">
                  <li>‚Ä¢ Consejos para organizar tu mudanza</li>
                  <li>‚Ä¢ Gu√≠as de embalaje profesional</li>
                  <li>‚Ä¢ Tips para ahorrar en tu mudanza</li>
                  <li>‚Ä¢ Noticias del sector</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Iframe del blog (intentar√° cargar primero) -->
        <iframe
          id="blog-iframe"
          src="https://blog.mudanzasandy.es/"
          class="w-full border-0"
          style="height: 800px; min-height: 600px;"
          title="Blog Mudanzas ANDY"
          loading="lazy"
          sandbox="allow-same-origin allow-scripts allow-forms allow-top-navigation allow-popups"
        ></iframe>
      </div>
    </section>

    <!-- Enlace directo al blog original -->
    <section class="bg-white py-6 border-t">
      <div class="container mx-auto px-4 text-center">
        <p class="text-gray-600 text-sm mb-2">
          ¬øPrefieres ver el blog en una ventana separada?
        </p>
        <a
          href="https://blog.mudanzasandy.es/"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 bg-brand text-white px-4 py-2 rounded-lg hover:bg-brand/90 transition-colors"
        >
          <span>üöÄ</span>
          <span>Abrir blog en nueva ventana</span>
        </a>
      </div>
    </section>
  </main>
</Layout>

<!-- Footer -->
<Footer />

<style>
  /* Estilos adicionales para el iframe */
  iframe {
    display: block;
    width: 100%;
    border: none;
    overflow: hidden;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    iframe {
      height: 600px !important;
      min-height: 500px;
    }
  }

  @media (max-width: 480px) {
    iframe {
      height: 500px !important;
      min-height: 400px;
    }
  }

  /* Loading state */
  iframe::before {
    content: "Cargando blog...";
    display: block;
    text-align: center;
    padding: 2rem;
    color: #666;
    font-family: system-ui, sans-serif;
  }
</style>

<script>
  // Script simple para detectar errores de iframe y mostrar fallback
  document.addEventListener("DOMContentLoaded", function () {
    const iframe = document.getElementById("blog-iframe") as HTMLIFrameElement;
    const fallbackDiv = document.getElementById("iframe-fallback");

    if (iframe && fallbackDiv) {
      let fallbackShown = false;

      // Funci√≥n para mostrar el fallback
      function showFallback() {
        if (!fallbackShown && fallbackDiv) {
          fallbackShown = true;
          iframe.style.display = "none";
          fallbackDiv.classList.remove("hidden");
          console.log("Mostrando p√°gina de fallback para el blog");
        }
      }

      // Detectar errores de carga del iframe
      iframe.addEventListener("error", function () {
        console.error("Error al cargar el iframe del blog");
        showFallback();
      });

      // Para detectar X-Frame-Options, usamos un timeout simple
      // En caso de problemas de CORS/X-Frame-Options, el iframe no cargar√° contenido
      setTimeout(() => {
        // Si llegamos aqu√≠ y no hay contenido visible, probablemente hay un error
        if (iframe.style.display !== "none" && !fallbackShown) {
          // Simplemente activamos el fallback despu√©s del timeout
          // En producci√≥n, el error de X-Frame-Options impide la carga del iframe
          console.warn(
            "Activando fallback por timeout o restricciones de iframe"
          );
          showFallback();
        }
      }, 4000); // 3 segundos de timeout

      // Interceptar errores de consola relacionados con X-Frame-Options
      const originalConsoleError = console.error;
      console.error = function (...args: any[]) {
        const message = args.join(" ").toLowerCase();
        if (
          message.includes("x-frame-options") ||
          message.includes("refused to display") ||
          message.includes("frame because it set")
        ) {
          showFallback();
        }
        originalConsoleError.apply(console, args);
      };
    }
  });
</script>
