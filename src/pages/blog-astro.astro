---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { getCollection } from "astro:content";

// Importar componentes del blog
import LatestPost from "../layouts/components/blog/LatestPost.astro";
import BlogPostList from "../layouts/components/blog/BlogPostList.astro";

// Obtener todos los posts del blog
const allPosts = await getCollection("blog");

// Filtrar posts publicados (no draft) y ordenar por fecha
const publishedPosts = allPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Obtener el √∫ltimo post publicado
const latestPost = publishedPosts[0];

// Obtener el resto de posts (excluyendo el √∫ltimo)
const remainingPosts = publishedPosts.slice(1);

const pageTitle =
  "Blog Mudanzas Barcelona - Consejos Econ√≥micos y Baratos | Mudanzas ANDY";
const pageDescription =
  "‚û§ Blog de mudanzas en Barcelona con consejos econ√≥micos y baratos. Gu√≠as profesionales para mudanzas econ√≥micas, tips para ahorrar, embalaje barato y traslados en toda la pen√≠nsula. ¬°Mudanzas ANDY - Calidad al mejor precio!";
// Canonical used in JSON-LD
const SITE_CANONICAL = "https://mudanzasandy.es";
---

<Layout
  title={pageTitle}
  description={pageDescription}
  image="/logos/logo-mudanzas-andy.svg"
  canonical="https://mudanzasandy.es/blog-astro/"
  keywords="mudanzas barcelona, mudanzas econ√≥micas, mudanzas baratas, mudanzas peninsula, consejos mudanza, embalaje barato, traslados econ√≥micos, mudanza econ√≥mica barcelona, presupuesto mudanza barato, mudanzas profesionales"
>
  <!-- Header fijo -->
  <Header />

  <main class="pt-20 md:pt-24 lg:pt-28" data-astro-transition-scope="blog">
    
    <!-- Mostrar el √∫ltimo post como hero -->
    {latestPost && (
      <LatestPost post={latestPost} />
    )}

    <!-- Lista de posts restantes -->
    {remainingPosts.length > 0 && (
      <BlogPostList 
        posts={remainingPosts}
        title="M√°s Art√≠culos del Blog"
        showMore={false}
      />
    )}

    <!-- Secci√≥n de CTA -->
    <section class="bg-gradient-to-br from-[rgb(var(--color-primary))] to-[rgb(var(--color-secondary))] text-white py-16">
      <div class="container mx-auto px-4 text-center">
        <h2 class="text-3xl lg:text-4xl font-bold mb-6">
          ¬øNecesitas una mudanza profesional en Barcelona?
        </h2>
        <p class="text-xl mb-8 max-w-2xl mx-auto">
          Nuestro equipo de expertos est√° listo para hacer de tu mudanza una experiencia f√°cil y sin estr√©s.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
          <a 
            href="/contacto"
            class="btn btn-accent inline-flex items-center gap-2 px-8 py-4 text-lg font-semibold"
          >
            üìû Solicitar Presupuesto Gratis
          </a>
          <a 
            href="tel:+34930000000"
            class="btn btn-outline-white inline-flex items-center gap-2 px-8 py-4 text-lg font-semibold"
          >
            ‚òéÔ∏è Llamar Ahora
          </a>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <Footer />

  <!-- Structured Data for SEO -->
  <script type="application/ld+json" is:inline>
    {
      "@context": "https://schema.org",
      "@type": "Blog",
      "name": "Blog de Mudanzas ANDY",
      "description": "Blog especializado en consejos, gu√≠as y art√≠culos sobre mudanzas profesionales en Barcelona y toda la pen√≠nsula. Tips para mudanzas econ√≥micas y baratas.",
      "url": "https://mudanzasandy.es/blog-astro/",
      "publisher": {
        "@type": "Organization",
        "name": "Mudanzas ANDY",
        "logo": {
          "@type": "ImageObject",
          "url": `${SITE_CANONICAL}/logos/logo-mudanzas-andy.svg`
        },
        "url": SITE_CANONICAL
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": `${SITE_CANONICAL}/blog-astro/`
      },
      "blogPost": [
        {publishedPosts.slice(0, 5).map((post) => `
        {
          "@type": "BlogPosting",
          "headline": "${post.data.title}",
          "description": "${post.data.description}",
          "url": "https://mudanzasandy.es/blog/${post.id}",
          "datePublished": "${post.data.pubDate.toISOString()}",
          "author": {
            "@type": "Person",
            "name": "${post.data.author || 'Equipo Mudanzas ANDY'}"
          },
          "publisher": {
            "@type": "Organization", 
            "name": "Mudanzas ANDY"
          }
        }`).join(',')}
      ],
      "keywords": "mudanzas barcelona, mudanzas econ√≥micas, mudanzas baratas, consejos mudanza, embalaje barato, traslados econ√≥micos, blog mudanzas",
      "about": [
        {
          "@type": "Thing",
          "name": "Mudanzas Barcelona"
        },
        {
          "@type": "Thing", 
          "name": "Mudanzas Econ√≥micas"
        },
        {
          "@type": "Thing",
          "name": "Consejos de Mudanza"
        }
      ]
    }
  </script>
</Layout>

<!-- Page styles removed: replaced by Tailwind utility classes on elements above -->
