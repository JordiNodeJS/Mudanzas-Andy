@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  /* Team section shared variables to avoid duplicated durations and easings */
  :root {
    --team-transition: 450ms;
    --team-title-transition: 800ms;
    --team-easing: cubic-bezier(0.2, 0.85, 0.25, 1);
  }

  /* Reusable card base: rounded, shadow, padding and hover lift */
  .card {
    @apply rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 transform hover:scale-105;
  }

  /* Slightly smaller card padding variant */
  .card-compact {
    @apply p-4;
  }

  /* Small wrapper for hover/animation used by many buttons */
  .btn-animated {
    @apply font-bold rounded-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center;
  }

  /* Primary brand button (yellow + text color) */
  .btn-primary {
    background-color: rgb(var(--color-highlight));
    color: rgb(var(--color-primary));
    border-radius: 9999px; /* rounded-full */
    font-weight: 700;
    padding: 0.5rem 1rem;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    transition: background-color 200ms ease, transform 200ms ease;
  }
  .btn-primary:hover {
    background-color: rgba(var(--color-highlight), 0.92);
  }

  /* Bordered card helper (keeps border utilities centralized) */
  .card-bordered {
    @apply border;
  }

  /* Posicionamiento específico para la imagen del camión en móvil */
  .mobile-truck-position {
    /* Variables controlables:
       - --truck-pos-x: mueve horizontalmente (0% = izquierda, 50% = centro, 100% = derecha)
       - --truck-pos-y-mobile: mueve verticalmente en móvil (0% = arriba, 100% = abajo)
       - --truck-clip-bottom-mobile: cuánto recortar desde la parte inferior en móvil (porcentaje)
    */
    --truck-pos-x: 50%;
    --truck-pos-y-mobile: 95%;
    --truck-clip-bottom-mobile: 15%;

    /* Aplicación de variables */
    object-position: var(--truck-pos-x) var(--truck-pos-y-mobile);
    clip-path: inset(0% 0% var(--truck-clip-bottom-mobile) 0%);
  }

  /* En pantallas más grandes, usar variables específicas de desktop */
  @media (min-width: 768px) {
    .mobile-truck-position {
      /* Valores por defecto para desktop: ajústalos si necesitas mover la imagen o cambiar el recorte */
      --truck-pos-y-desktop: 65%;
      --truck-clip-bottom-desktop: 5%;

      object-position: var(--truck-pos-x) var(--truck-pos-y-desktop);
      clip-path: inset(0% 0% var(--truck-clip-bottom-desktop) 0%);
    }
  }

  /* Team card: enforce consistent proportions (image area on top, content below) */
  .team-card {
    display: flex;
    flex-direction: column;
    height: 100%; /* relies on parent (.items-stretch + h-full) */
    background-clip: padding-box; /* keep rounded corners clean when media overflows */
  }

  .team-card__media {
    /* Fixed height for consistent proportions */
    height: 200px;
    overflow: hidden;
    flex: 0 0 auto;
  }

  @media (min-width: 1024px) {
    .team-card__media {
      height: 220px;
    }
  }

  .team-card__body {
    /* Do not grow to fill the card — keep height tight to content to avoid large empty areas */
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* start from top, no centering */
    padding: 0.75rem 1rem; /* reduce vertical and horizontal padding */
    gap: 0.25rem; /* smaller spacing between title and description */
  }

  @media (min-width: 768px) {
    .team-card-2 .mobile-truck-position {
      --truck-pos-y-desktop: 65%; /* más abajo para reducir cielo */
      --truck-clip-bottom-desktop: 5%;
    }
  }

  /* Filtros estilo fondo/overlay para las imágenes del equipo profesional */
  /* Las imágenes se tratan como fondos: tinte sutil + desaturado, al hover se aclaran. */
  .team-card__media {
    position: relative;
    overflow: hidden; /* asegurar recorte del pseudo-elemento */
  }

  /* Hover behavior: expand image area smoothly and push content down.
     We use max-height + transform to allow smooth GPU-accelerated transitions. */
  .team-card__media {
    --team-media-height: 12rem; /* default 192px */
    height: var(--team-media-height);
    transition: height 450ms cubic-bezier(0.2, 0.9, 0.2, 1),
      transform 450ms ease;
  }

  @media (min-width: 768px) {
    .team-card__media {
      --team-media-height: 14rem; /* 224px on md+ */
    }
  }

  .team-image-filter {
    /* Estado base: aspecto de fondo con tinte sutil y ligera desaturación */
    /* Reemplazamos el tinte gris por un degradado de color usando variables del sistema */
    filter: brightness(0.98) contrast(1.04) saturate(1.08);
    position: relative;
    z-index: 0;
    opacity: 1;
    background-image: linear-gradient(
      135deg,
      rgba(var(--color-accent), 0.18),
      rgba(var(--color-neutral), 0.08) 45%,
      rgba(var(--color-primary), 0.12) 100%
    );
    background-blend-mode: color;
    mix-blend-mode: multiply;
    transform-origin: center center;
    /* Transiciones sincronizadas y más cortas para evitar arrastres al salir del hover */
    transition: filter var(--team-transition) ease,
      transform var(--team-transition) ease, opacity var(--team-transition) ease;
    will-change: filter, transform, opacity;
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* More specific selector to ensure opacity transition isn't overridden; no !important. */
  .team-card .team-card__media .team-image-filter {
    transition: filter var(--team-transition) ease,
      transform var(--team-transition) ease, opacity var(--team-transition) ease;
    will-change: opacity, filter, transform;
  }

  /* variantes para experimentar */
  .team-image-filter--multiply {
    mix-blend-mode: multiply;
  }
  .team-image-filter--screen {
    mix-blend-mode: screen;
  }
  .team-image-filter--soft-light {
    mix-blend-mode: soft-light;
  }
  .team-image-filter--hard-light {
    mix-blend-mode: hard-light;
  }
  .team-image-filter--color {
    mix-blend-mode: color;
  }
  .team-image-filter--luminosity {
    mix-blend-mode: luminosity;
  }
  .team-image-filter--difference {
    mix-blend-mode: difference;
  }

  /* Pseudo-overlay que actúa como fondo de la imagen (estilo tarjetas) */
  .team-card__media::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    /* Gradiente base que mezcla con la paleta del sitio */
    background: linear-gradient(
      135deg,
      rgba(var(--color-accent), 0.12) 0%,
      rgba(var(--color-neutral), 0.08) 45%,
      rgba(var(--color-primary), 0.08) 100%
    );
    mix-blend-mode: multiply; /* se comporta como fondo sobre la imagen */
    opacity: 0.9;
    /* Unificar duración con la imagen para evitar desincronización al salir del hover */
    transition: opacity var(--team-transition) ease,
      background var(--team-transition) ease;
    z-index: 1;
  }

  /* Al hover aclaramos la imagen y reducimos el overlay para 'revelarla' */
  .team-card:hover .team-image-filter {
    filter: grayscale(0%) brightness(1.03) contrast(1.06) saturate(1.05);
  }

  /* When the card is hovered, smoothly expand the media area to reveal more image.
     We also hide the description and pin the title to the bottom of the body. */
  .team-card:hover .team-card__media {
    --team-media-height: 15rem; /* reduced expansion to ~240px on hover to remove extra gap */
  }

  /* Mirror hover behaviour to an explicit class so tests can simulate hover */
  .team-card.is-hover .team-image-filter {
    filter: grayscale(0%) brightness(1.03) contrast(1.06) saturate(1.05);
  }

  .team-card.is-hover .team-card__media {
    --team-media-height: 15rem;
    transform: translateZ(0);
  }

  /* Accessibility: mirror hover behaviour for keyboard users using :focus-within */
  .team-card:focus-within .team-image-filter,
  .team-card:focus-within .team-card__media {
    filter: grayscale(0%) brightness(1.03) contrast(1.06) saturate(1.05);
    transform: scale(1.02);
  }

  .team-card:focus-within .team-card__media {
    --team-media-height: 15rem;
    transform: translateZ(0);
  }

  /* Body layout adjustments: pin the title to bottom and hide description on hover */
  .team-card__body {
    display: flex;
    flex-direction: column;
    justify-content: flex-end; /* push title to the bottom when media expands */
    position: relative;
    z-index: 2; /* ensure body content sits above pseudo-overlay */
  }

  .team-card__body h3 {
    margin: 0 0 0.5rem 0;
    /* Transición del título: más suave pero sincronizada con la imagen */
    transition: transform var(--team-title-transition) var(--team-easing),
      color 250ms ease;
    will-change: transform;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }

  .team-card__desc {
    transition: opacity 300ms ease, transform 300ms ease;
    opacity: 1;
  }
  /* Keep description visible on hover. Preserve transitions but don't hide. */
  .team-card:hover .team-card__desc,
  .team-card.is-hover .team-card__desc {
    opacity: 1;
    transform: none;
    pointer-events: auto;
    transition: opacity 300ms ease, transform 300ms ease;
    text-align: left; /* ensure description stays left-aligned */
    align-self: stretch; /* allow it to take full width while staying left-aligned */
  }

  /* On hover/forced state, vertically center content but keep description left-aligned.
     The title will scale and be centered within its own line. */
  .team-card:hover .team-card__body,
  .team-card.is-hover .team-card__body {
    justify-content: center;
    align-items: stretch; /* keep horizontal stretch so desc remains left-aligned */
  }

  .team-card:hover .team-card__body h3,
  .team-card.is-hover .team-card__body h3 {
    transform-origin: left center; /* scale from the left so it stays left-aligned */
    /* Movimiento muy suave y escala moderada para reducir agresividad */
    transform: scale(1.1);
    line-height: 1.05;
    width: 100%;
    text-align: left; /* keep title left-aligned on hover */
    margin-left: 0;
    margin-right: 0;
  }

  /* Slightly smaller scale on small screens to avoid overflow */
  @media (max-width: 767px) {
    .team-card:hover .team-card__body h3,
    .team-card.is-hover .team-card__body h3 {
      transform-origin: left center;
    }
  }

  .team-card:hover .team-card__media::after {
    opacity: 0.25; /* deja ver la imagen más limpia */
  }

  /* Variantes por tarjeta usando gradientes puntuales (coinciden con ServicesSection) */
  .team-card--variant-primary .team-card__media::after {
    background: linear-gradient(
      135deg,
      rgba(249, 180, 171, 0.16),
      rgba(253, 235, 211, 0.06)
    );
  }

  .team-card--variant-secondary .team-card__media::after {
    background: linear-gradient(
      135deg,
      rgba(103, 145, 134, 0.16),
      rgba(187, 212, 206, 0.06)
    );
  }

  .team-card--variant-accent .team-card__media::after {
    background: linear-gradient(
      135deg,
      rgba(38, 78, 112, 0.16),
      rgba(187, 212, 206, 0.06)
    );
  }

  /* (consolidado arriba) */

  /* Final override with higher specificity to avoid needing !important.
     Placed at the end so it wins if load order otherwise conflicts. */
  html body .team-card .team-card__media > .team-image-filter,
  html body .team-card .team-card__media .team-image-filter {
    transition: filter 450ms ease, transform 450ms ease, opacity 450ms ease;
    will-change: opacity, filter, transform;
  }
}
